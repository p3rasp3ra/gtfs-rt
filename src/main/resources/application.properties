# =============================================================================
# GTFS-RT Application - Base Configuration
# Profile-independent settings. Override via environment-specific profiles.
# =============================================================================

spring.application.name=gtfs-rt

# Server Configuration
server.port=${SERVER_PORT:8088}

# Disable Docker Compose auto-start (we manage compose externally)
spring.docker.compose.enabled=false

# -----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# -----------------------------------------------------------------------------
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/gtfs_realtime_db}
spring.datasource.username=${DB_USERNAME:gtfsuser}
spring.datasource.password=${DB_PASSWORD:gtfs_password}
spring.datasource.driver-class-name=org.postgresql.Driver

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=${JPA_SHOW_SQL:false}
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# HikariCP Connection Pool
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL:20}
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000

# -----------------------------------------------------------------------------
# Kafka Configuration
# -----------------------------------------------------------------------------
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9093}
spring.kafka.consumer.group-id=gtfs-rt-processor
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.max-poll-records=100
spring.kafka.consumer.fetch-min-size=1024

# Kafka Topics
kafka.topics.vehicle-positions=gtfsrt.vp.raw
kafka.topics.vehicle-positions-proto=vp-proto
kafka.topics.trip-updates=gtfsrt.tu.raw
kafka.topics.service-alerts=gtfsrt.sa.raw

# Kafka DLQ Topics
kafka.topics.vehicle-positions.slow-path-dlq=gtfsrt.vp.slow-path.DLT
kafka.topics.vehicle-positions.fast-path-dlq=gtfsrt.vp.fast-path.DLT

# Kafka Consumer Groups
kafka.consumer.group-id-fast=vp-fast-consumer
kafka.consumer.group-id-slow=vp-slow-consumer

# -----------------------------------------------------------------------------
# MQTT Configuration (Digitransit format)
# -----------------------------------------------------------------------------
mqtt.broker.url=${MQTT_BROKER_URL:tcp://localhost:1883}
mqtt.client.id=gtfs-rt-service-${random.uuid}
mqtt.username=${MQTT_USERNAME:}
mqtt.password=${MQTT_PASSWORD:}
mqtt.qos=1

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.timeout=2000ms

# -----------------------------------------------------------------------------
# Runtime Configuration
# -----------------------------------------------------------------------------
spring.threads.virtual.enabled=true

# Actuator
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.probes.enabled=true
management.endpoint.health.show-details=when_authorized

# GTFS-RT Feed
gtfs.feed.version=2.0
gtfs.feed.incrementality=FULL_DATASET
gtfs.feed.cache.ttl-seconds=30

